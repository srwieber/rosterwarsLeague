<style>
#loading {
  margin:auto;
  text-align:center;
  font-size:32px;
}
#rfaLayout {
  display:flex;  
  justify-content: center;
}
#rfaLayout .col1 {
  max-width:215px;
}
#rfa h2 {
  margin:5px;
  padding:5px;
  background:#000;
  border:1px solid #333;
  border-radius:5px;
}
#rfa h2 img{
  vertical-align:bottom;
}
#rfa h3 span, #rfa h3 img {
  cursor:pointer;
}
#rfa h3 span {
  text-decoration: underline;
}
#rfa h3 span:hover {
  text-decoration: none;
}
#rfa h3 img{
  vertical-align:middle;
}
#rfa h3 img.franchiseicon {
  width:190px;
  min-width:190px;
}
#rfa h3 img:hover{
  opacity:0.5;
}
#rfa .franchiseicon {
  width:100px;
}
#rfa #franchiseicon_0000 {height:20px;width:auto;}
#rfa .report {
  margin:auto;
  min-width:356px;
}
#rfa .report a {
  color:#000!important;
}
#rfa .report td:first-child {
  width:0;
}
#rfa .report .activate {display:table-row;}
#rfa .report .deactivate {display:none;}
#rfa .report tr td {
  background-color:#d9d9d9;
  color:#000;
  border-bottom:1px solid #999;
}
#rfa .report tr:hover td {
  background-color:#ccc;
}
#rfa, #rosterRFA, #rfaSorting {display:none;}
</style>

<div id="loading">Loading...</div>
<div id="rfa" class="mobile-wrap">
  <h2>Selected Team: <span id="teamcaption"></span> Position: <span id="positioncaption"></span></h2>
  <div id="rfaLayout" class="mobile-wrap">
    <div class="col1">
      <h3 id="team_select">Team: <br /></h3>
    </div>
    <div class="col2">
      <h3>Position: <br />
        <span class="position_all">ALL</span><br />
        <span class="position_qb">QB</span><br />
        <span class="position_rb">RB</span><br />
        <span class="position_wr">WR</span><br />
        <span class="position_te">TE</span><br />
        <span class="position_pk">PK</span><br />
        <span class="position_dt">DT</span><br />
        <span class="position_de">DE</span><br />
        <span class="position_dt">LB</span><br />
        <span class="position_cb">CB</span><br />
        <span class="position_s">S</span>
      </h3>
    </div>
    <div class="col3">
      <table class="homepagemodule report"><caption><span>RFA List</span></caption></table>
    </div>
  </div>
</div>

<div id="rosterRFA"></div>

<div id="rfaSorting">
<table id="p200"><tr class="emptyheader"><th>empty header</th></tr></table>
<table id="p150"><tr class="emptyheader"><th>empty header</th></tr></table>
<table id="p100"><tr class="emptyheader"><th>empty header</th></tr></table>
<table id="p75"><tr class="emptyheader"><th>empty header</th></tr></table>
<table id="p50"><tr class="emptyheader"><th>empty header</th></tr></table>
<table id="p25"><tr class="emptyheader"><th>empty header</th></tr></table>
<table id="p10"><tr class="emptyheader"><th>empty header</th></tr></table>
<table id="p0"><tr class="emptyheader"><th>empty header</th></tr></table>
</div>

<script>
let contractYear = 1;
let allTeams = 'https://i39.servimg.com/u/f39/15/70/85/29/1rwdoc10.png';
let clickedPos = 'position_all';
let clickedTeam = 'franchiseicon_0000';
let teamCaption;
let positionCaption = 'All';
let sortCol = 'td.points a';

function getMyRosters() {
	url = baseURLDynamic + "/" + year + "/options?L=" + league_id + "&O=07&PRINTER=1";
	$.ajax({
		url: url,
		type: "GET",
		dataType: "html",
		async: false,
		success: function (data) {
			roster = $(data).find('table .report');
			$(roster).prependTo('#rosterRFA');
			createMyRosters();
		}
	});
}
getMyRosters();

function createMyRosters() {
	$('#rosterRFA a').attr('href', function (i, href) {
		return href.replace('&PRINTER=1', '');
	});
	$('#rosterRFA a').attr('target','_blank');

	$('#rosterRFA .report td.week, #rosterRFA .report td.drafted').remove();
	$('#team_select').append('<img id="franchiseicon_0000" title="All Teams" src="' + allTeams + '">');
	$('#rosterRFA .report caption a img').each(function( i ) {
		let teamselect = $(this).clone();
		$(teamselect).appendTo('#team_select');
	});
	teamCaption = $('<img title="All Teams" id="franchiseicon_0000" src="' + allTeams + '">');
	$('#rosterRFA .report tr').each(function( i ) {
		let contyear = $(this).find('td.contractyear').html();
		let conyear = parseInt(contyear);
		if (conyear !== contractYear){
			$(this).remove();
		}else {
			let teamicon = $(this).closest('table').find('caption a').clone();
			$(this).find('td.player').before('<td class="team">team icon</td>');
			$(this).find('td.team').html(teamicon);
			$(this).removeClass('newposition oddtablerow eventablerow');
			$(this).addClass( $(this).find('td.player a').attr('class') );
			$(this).addClass( $(this).find('td.team img').attr('id') );
			$(this).addClass('activate');
			if($(this).find('td.points a').length < 1) {
				$(this).find('td.points').html('<a href="#" target="_blank">0.0</a>');
			}
			let x= $(this).find('.points a').text();
			if(parseInt(x) > 200){
				$(this).appendTo($('#rfaSorting #p200'));
			}else if(parseInt(x) > 150 && parseInt(x) <= 200){
				$(this).appendTo($('#rfaSorting #p150'));
			}else if(parseInt(x) > 100 && parseInt(x) <= 150){
				$(this).appendTo($('#rfaSorting #p100'));
			}else if(parseInt(x) > 75 && parseInt(x) <= 100){
				$(this).appendTo($('#rfaSorting #p75'));
			}else if(parseInt(x) > 50 && parseInt(x) <= 75){
				$(this).appendTo($('#rfaSorting #p50'));
			}else if(parseInt(x) > 25 && parseInt(x) <= 50){
				$(this).appendTo($('#rfaSorting #p25'));
			}else if(parseInt(x) > 10 && parseInt(x) <= 25){
				$(this).appendTo($('#rfaSorting #p10'));
			}else if(parseInt(x) <= 10){
				$(this).appendTo($('#rfaSorting #p0'));
			}
			$(this).find('td.contractyear').remove();
		};
	});
	setTimeout(function() { 
		sortRowsRFA();
	}, 100);
}

function sortRowsRFA() {
	var table, rows, switching, i, x, y, shouldSwitch;
	$("#rfaSorting table").each( function(){
		switching = true;
		while (switching) {
			switching = false;
			rows = $(this).find('tr');
			for (i = 1; i < (rows.length - 1); i++) {
				shouldSwitch = false;
				x = $(rows[i]).find(sortCol).text();
				y = $(rows[i + 1]).find(sortCol).text();
				if ( Math.round(x * 100) < Math.round(y * 100) ) {
					shouldSwitch = true;
					break;
				}
			}
			if (shouldSwitch) {
				rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
				switching = true;
			}
		}
	});
	$("#rfaSorting table tr").not('.emptyheader').appendTo('#rfa .report');
	$("#rosterRFA table").each( function(){
		let x = $(this).find('tr').length;
		if (x < 1){
			$(this).remove();
		}
	});
	$("#rfaSorting table").each( function(){
		let x = $(this).find('tr').length;
		if (x < 2){
			$(this).remove();
		}
	});
	$('#rfa .report tr:first-of-type').before('<tr><th>Team</th><th>Player</th><th>Points</th></tr>');
	$('#rfa .report tr:last-of-type').after('<tr class="deactivate"><td colspan="3">No Players Available</td></tr>');
	$('#rfa, #rosterRFA, #rfaSorting').show();
	$('#loading').hide();
	posChangeRFA();
}

function posChangeRFA(){
	$('#rfa .report tr').removeClass('activate').addClass('deactivate');
	if (clickedPos === 'position_all') {
		$('#rfa .report tr').addClass('position_all');
	}else if (clickedPos !== 'position_all') {
		$('#rfa .report tr').removeClass('position_all');
	}

	if (clickedTeam === 'franchiseicon_0000') {
		$('#rfa .report tr').addClass('franchiseicon_0000');
	}else if (clickedTeam !== 'franchiseicon_0000') {
		$('#rfa .report tr').removeClass('franchiseicon_0000');
	}
	$('#rfa .report tr.' + clickedPos + '.' + clickedTeam).addClass('activate').removeClass('deactivate');
	$('#rfa .report tr:nth-of-type(1)').removeClass('deactivate').addClass('activate');
	let visibleRows = $('#rfa .report tr:visible').length;
	if (visibleRows === 1){
		$('#rfa .report tr:last-of-type').addClass('activate').removeClass('deactivate');
	}else{
		$('#rfa .report tr:last-of-type').removeClass('activate').addClass('deactivate');
	}
	$('#positioncaption').html(positionCaption);
	$('#teamcaption').html(teamCaption);
}

$(document).on('click', '#rfa h3 span', function (index) {
	clickedPos = $(this).attr('class');
	positionCaption = $(this).text();
	posChangeRFA();
});
$(document).on('click', '#rfa #team_select img', function (index) {
	clickedTeam = $(this).attr('id');
	teamCaption = $(this).clone();
	posChangeRFA();
});

</script>
